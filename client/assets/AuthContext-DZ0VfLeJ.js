import{a as r,o as _}from"./chunk-NL6KNZEE-bQRukl_s.js";const n="https://testsso.asiradnan.com/api/auth",i={REGISTER_CHALLENGE:`${n}/register/challenge/`,REGISTER_VERIFY:`${n}/register/verify/`,LOGIN_CHALLENGE:`${n}/login/challenge/`,LOGIN_VERIFY:`${n}/login/verify/`,VERIFY_TOKEN:`${n}/verify-token/`,USER_PROFILE:`${n}/profile/`,CLEAR_CHALLENGES:`${n}/clear-challenges/`};async function a(e,E="GET",c,l){const u={"Content-Type":"application/json"};l&&(u.Authorization=`Bearer ${l}`);const h={method:E,headers:u,credentials:"include"};c&&(h.body=JSON.stringify(c));try{const s=await fetch(e,h);if(!s.ok){const o=await s.json().catch(()=>({}));throw new Error(o.error||o.detail||`API request failed with status ${s.status}`)}return s.json()}catch(s){throw console.error(`API request failed for ${e}:`,s),s}}const S={getRegistrationChallenge:e=>a(i.REGISTER_CHALLENGE,"POST",e),verifyRegistration:e=>a(i.REGISTER_VERIFY,"POST",e),getAuthenticationChallenge:e=>a(i.LOGIN_CHALLENGE,"POST",e),verifyAuthentication:e=>a(i.LOGIN_VERIFY,"POST",e),verifyToken:e=>a(i.VERIFY_TOKEN,"POST",{token:e}),getUserProfile:e=>a(i.USER_PROFILE,"GET",void 0,e),clearChallenges:e=>a(i.CLEAR_CHALLENGES,"POST",e)},R=r.createContext(void 0);function y({children:e}){const[E,c]=r.useState(null),[l,u]=r.useState(null),[h,s]=r.useState(!0),[o,L]=r.useState(!1);r.useEffect(()=>{L(!0)},[]),r.useEffect(()=>{if(!o)return;const t=localStorage.getItem("sso_token");t?I(t):s(!1)},[o]);const I=async t=>{try{s(!0);const f=await S.verifyToken(t);f.valid||f.success?(c(f.user),u(t),o&&localStorage.setItem("sso_token",t)):g()}catch(f){console.error("Token verification failed:",f),g()}finally{s(!1)}},d=async()=>{if(l)try{const t=await S.getUserProfile(l);c(t.user||t)}catch(t){console.error("Failed to refresh user data:",t),t instanceof Error&&t.message.includes("401")&&g()}},A=t=>{u(t),o&&localStorage.setItem("sso_token",t),I(t)},g=()=>{c(null),u(null),o&&localStorage.removeItem("sso_token"),s(!1)},T={user:E,isAuthenticated:!!E,isLoading:h,ssoToken:l,login:A,logout:g,refreshUser:d};return _.jsx(R.Provider,{value:T,children:e})}function C(){const e=r.useContext(R);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}export{y as A,S as a,C as u};
